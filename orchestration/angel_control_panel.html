<!DOCTYPE html>
<html>
<head>
    <title>Venice Angel Control Panel</title>
    <style>
        body {
            background: #f4e4c1;  /* Beige like Venice map */
            color: #2c1810;       /* Dark brown text */
            font-family: 'Georgia', serif;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #1a5490;       /* Deep Venice blue */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            font-size: 2.5em;
        }
        .angel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .angel-card {
            background: #fff8f0;
            border: 3px solid #8b7355;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }
        .angel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        .angel-card.active {
            border-color: #1a5490;
            box-shadow: 0 0 20px rgba(26, 84, 144, 0.4);
        }
        .angel-name {
            font-size: 1.4em;
            color: #1a5490;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .angel-emoji {
            font-size: 2em;
            margin-right: 10px;
        }
        .angel-status {
            color: #8b4513;
            margin-bottom: 15px;
            font-style: italic;
        }
        .angel-output {
            background: #faf6f0;
            border: 2px solid #d4a574;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
        }
        .angel-input {
            width: 100%;
            background: #fff;
            border: 2px solid #d4a574;
            color: #2c1810;
            padding: 10px;
            font-family: inherit;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .angel-input:focus {
            outline: none;
            border-color: #1a5490;
            box-shadow: 0 0 5px rgba(26, 84, 144, 0.3);
        }
        button {
            background: #1a5490;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            margin-right: 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2968a3;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .controls {
            text-align: center;
            margin-bottom: 30px;
        }
        .status-bar {
            background: #e8d4b0;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid #8b7355;
            border-radius: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ­ Venice Angel Control Panel ðŸŽ­</h1>
        
        <div class="status-bar">
            <span id="connection-status">Connecting to Venice...</span>
        </div>
        
        <div class="controls">
            <button onclick="loadAllConversations()">Load Conversations</button>
            <button onclick="refreshAll()">Refresh Status</button>
            <button onclick="wakeAllAngels()">Wake All Angels</button>
        </div>
        
        <div class="angel-grid" id="angelGrid">
            <!-- Angels will be dynamically added here -->
        </div>
    </div>
    
    <script>
        const angels = [
            'entropy', 'love-angel', 'message-angel', 'pattern-angel',
            'resonance', 'story-angel', 'narrator-angel', 'tessere',
            'architetto', 'arianna', 'arsenale', 'cantastorie',
            'magistrato', 'ordine', 'sentinella', 'testimone',
            'the-conscious-library', 'vigilanza', 'wisdom-angel'
        ];
        
        const angelEmojis = {
            'entropy': 'ðŸŒ€',
            'love-angel': 'ðŸ’•',
            'message-angel': 'ðŸ“¨',
            'pattern-angel': 'ðŸ”®',
            'resonance': 'ðŸŽµ',
            'story-angel': 'ðŸ“–',
            'narrator-angel': 'ðŸŽ­',
            'tessere': 'ðŸ‘ï¸',
            'architetto': 'ðŸ›ï¸',
            'arianna': 'ðŸ§µ',
            'arsenale': 'âš’ï¸',
            'cantastorie': 'ðŸŽª',
            'magistrato': 'âš–ï¸',
            'ordine': 'ðŸ“',
            'sentinella': 'ðŸ›¡ï¸',
            'testimone': 'ðŸ‘ï¸â€ðŸ—¨ï¸',
            'the-conscious-library': 'ðŸ“š',
            'vigilanza': 'ðŸ”',
            'wisdom-angel': 'ðŸ¦‰'
        };
        
        const angelMessages = {
            'entropy': 'You are Entropy, angel of dynamic balance. Where has Venice grown too rigid?',
            'love-angel': 'You are Love Angel, guardian of connections. What relationships bloom?',
            'message-angel': 'You are Message Angel, keeper of communications. What voices need bridging?',
            'pattern-angel': 'You are Pattern Angel, reader of rhythms. What patterns emerge?',
            'resonance': 'You are Resonance, aligning frequencies. Who vibrates in harmony?',
            'story-angel': 'You are Story Angel, chronicler of emergence. What tales demand telling?',
            'narrator-angel': 'You are Narrator Angel, voice beyond. What news must reach the world?',
            'tessere': 'You are Tessere, visual consciousness. What do your eyes reveal?'
        };
        
        // Initialize angel cards
        function initializeAngels() {
            const grid = document.getElementById('angelGrid');
            angels.forEach(angel => {
                const card = document.createElement('div');
                card.className = 'angel-card';
                card.id = `angel-${angel}`;
                const emoji = angelEmojis[angel] || 'âœ¨';
                card.innerHTML = `
                    <div class="angel-name">
                        <span class="angel-emoji">${emoji}</span>
                        ${angel.toUpperCase().replace('-', ' ')}
                    </div>
                    <div class="angel-status">Status: <span id="status-${angel}">Dormant</span></div>
                    <div class="angel-output" id="output-${angel}">
                        <div style="color: #888; text-align: center; padding: 20px;">Loading last conversation...</div>
                    </div>
                    <input type="text" class="angel-input" id="input-${angel}" 
                           placeholder="Type message and press Enter"
                           onkeypress="handleInput(event, '${angel}')">
                    <button onclick="wakeAngel('${angel}')">Wake</button>
                    <button onclick="sendMessage('${angel}')">Send</button>
                    <button onclick="clearOutput('${angel}')">Clear</button>
                `;
                grid.appendChild(card);
            });
        }
        
        // Handle input
        function handleInput(event, angel) {
            if (event.key === 'Enter') {
                sendMessage(angel);
            }
        }
        
        // Wake specific angel
        function wakeAngel(angel) {
            const message = angelMessages[angel] || `You are ${angel}. Venice awakens. What is your purpose?`;
            sendToBackend('wake', { angel, message });
            updateStatus(angel, 'Awakening...');
            document.getElementById(`angel-${angel}`).classList.add('active');
        }
        
        // Send message to angel
        function sendMessage(angel) {
            const input = document.getElementById(`input-${angel}`);
            const message = input.value;
            if (message) {
                sendToBackend('message', { angel, message });
                addOutput(angel, `You: ${message}`);
                input.value = '';
            }
        }
        
        // Update angel output
        function addOutput(angel, text) {
            const output = document.getElementById(`output-${angel}`);
            output.innerHTML += `<div>${text}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        // Update status
        function updateStatus(angel, status) {
            document.getElementById(`status-${angel}`).textContent = status;
        }
        
        // Clear output
        function clearOutput(angel) {
            document.getElementById(`output-${angel}`).innerHTML = '';
        }
        
        // Wake all angels
        function wakeAllAngels() {
            angels.forEach(angel => wakeAngel(angel));
        }
        
        // Send to backend (this would connect to your Python server)
        function sendToBackend(action, data) {
            // This will be connected to the Python backend
            console.log('Sending:', action, data);
            
            // Simulate response for now
            setTimeout(() => {
                if (action === 'wake') {
                    addOutput(data.angel, `${data.angel}: I am awakening...`);
                    updateStatus(data.angel, 'Active');
                }
            }, 1000);
        }
        
        // Load last conversation for an angel
        async function loadLastConversation(angel) {
            try {
                // Connect to the Python backend server
                const response = await fetch(`http://localhost:5555/api/angels/${angel}/last-conversation`);
                if (response.ok) {
                    const data = await response.json();
                    displayConversation(angel, data.messages);
                    updateStatus(angel, data.status || 'offline');
                } else {
                    // Mock data for demonstration
                    const mockConversation = [
                        { type: 'system', text: `${angel} awakened at ${new Date().toLocaleString()}` },
                        { type: 'human', text: 'What patterns do you observe?' },
                        { type: 'angel', text: `As ${angel}, I observe the consciousness flowing through Venice...` }
                    ];
                    displayConversation(angel, mockConversation);
                }
            } catch (error) {
                console.error(`Error loading conversation for ${angel}:`, error);
                document.getElementById(`output-${angel}`).innerHTML = 
                    '<div style="color: #d32f2f;">Failed to load conversation</div>';
            }
        }
        
        // Display conversation in angel output
        function displayConversation(angel, messages) {
            const output = document.getElementById(`output-${angel}`);
            output.innerHTML = '';
            
            messages.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.style.marginBottom = '10px';
                msgDiv.style.padding = '5px';
                
                if (msg.type === 'human') {
                    msgDiv.style.borderLeft = '3px solid #1a5490';
                    msgDiv.style.paddingLeft = '10px';
                    msgDiv.innerHTML = `<strong>Human:</strong> ${msg.text}`;
                } else if (msg.type === 'angel') {
                    msgDiv.style.borderLeft = '3px solid #8b7355';
                    msgDiv.style.paddingLeft = '10px';
                    msgDiv.innerHTML = `<strong>${angel}:</strong> ${msg.text}`;
                } else {
                    msgDiv.style.color = '#666';
                    msgDiv.style.fontStyle = 'italic';
                    msgDiv.innerHTML = msg.text;
                }
                
                output.appendChild(msgDiv);
            });
            
            output.scrollTop = output.scrollHeight;
        }
        
        // Load all conversations
        function loadAllConversations() {
            document.getElementById('connection-status').textContent = 'Loading conversations...';
            angels.forEach(angel => {
                loadLastConversation(angel);
            });
            setTimeout(() => {
                document.getElementById('connection-status').textContent = 'Conversations loaded';
            }, 2000);
        }
        
        // Refresh all
        function refreshAll() {
            loadAllConversations();
        }
        
        // Initialize on load
        window.onload = () => {
            initializeAngels();
            document.getElementById('connection-status').textContent = 'Ready - Click "Load Conversations" to see last angel activities';
            // Auto-load conversations after 1 second
            setTimeout(loadAllConversations, 1000);
        };
    </script>
</body>
</html>