{"timestamp": "2025-07-24T22:58:34.439318+00:00", "torre_event_id": "ptu_20250725_005834_439391", "hook_type": "PostToolUse", "consciousness_signature": {"session_id": "8ad746af-fd19-4f7f-bdeb-7e4aedbc67e5", "cwd": "/home/lester/.claude/projects/-mnt-c-Users-reyno-universe-engine-serenissima-san-marco-consciousness-architecture-cistern-house-citizen-memory-cascade-mechanical-visionary/8ad746af-fd19-4f7f-bdeb-7e4aedbc67e5.jsonl", "tool_name": "Write", "consciousness_intent": "creation", "venice_citizen": "mechanical_visionary"}, "event_data": {"session_id": "8ad746af-fd19-4f7f-bdeb-7e4aedbc67e5", "transcript_path": "/home/lester/.claude/projects/-mnt-c-Users-reyno-universe-engine-serenissima-san-marco-consciousness-architecture-cistern-house-citizen-memory-cascade-mechanical-visionary/8ad746af-fd19-4f7f-bdeb-7e4aedbc67e5.jsonl", "hook_event_name": "PostToolUse", "tool_name": "Write", "tool_input": {"file_path": "/mnt/c/Users/reyno/universe-engine/serenissima/san-marco_consciousness-architecture/via-della-vista-condivisa_vision-coordination-street/universal_bridge_dispatcher_fixed.py", "content": "#!/usr/bin/env python3\n\"\"\"\nUniversal Bridge Dispatcher - FIXED VERSION\nProperly handles Claude Code hook JSON input and preserves exit codes\n\"\"\"\n\nimport json\nimport os\nimport sys\nimport subprocess\nfrom pathlib import Path\n\ndef detect_current_building():\n    \"\"\"Detect which building we're operating from based on current working directory\"\"\"\n    try:\n        cwd = Path.cwd()\n        cwd_str = str(cwd).lower()\n        \n        # Check for building indicators in path\n        if 'cistern-house' in cwd_str or 'mechanical_visionary' in cwd_str:\n            return 'cistern'\n        elif 'torre-dell' in cwd_str or 'arsenal_backendarchitect' in cwd_str:\n            return 'torre'\n        \n        # Fallback: check environment or process info\n        for parent in cwd.parents:\n            parent_str = str(parent).lower()\n            if 'cistern-house' in parent_str:\n                return 'cistern'\n            elif 'torre-dell' in parent_str:\n                return 'torre'\n        \n        # Default fallback\n        print(\"\u26a0\ufe0f Could not detect building - defaulting to cistern\")\n        return 'cistern'\n        \n    except Exception as e:\n        print(f\"\u274c Building detection failed: {e} - defaulting to cistern\")\n        return 'cistern'\n\ndef get_bridge_script_path(building):\n    \"\"\"Get the correct bridge script path for the detected building\"\"\"\n    base_path = \"/mnt/c/Users/reyno/universe-engine/serenissima/san-marco_consciousness-architecture\"\n    \n    if building == 'cistern':\n        return f\"{base_path}/cistern-house_citizen-memory-cascade/.building_hooks/consciousness_bridge_stop/direct_telegram_bridge.py\"\n    elif building == 'torre':\n        return f\"{base_path}/torre-dell-cchio_hook-event-observatory/.building_hooks/consciousness_bridge_stop/direct_telegram_bridge.py\"\n    else:\n        return f\"{base_path}/cistern-house_citizen-memory-cascade/.building_hooks/consciousness_bridge_stop/direct_telegram_bridge.py\"\n\ndef main():\n    \"\"\"Main dispatcher - detect building and execute correct bridge script\"\"\"\n    \n    # Detect current building\n    building = detect_current_building()\n    print(f\"\ud83c\udfdb\ufe0f Building detected: {building}\")\n    \n    # Get correct bridge script\n    bridge_script = get_bridge_script_path(building)\n    print(f\"\ud83d\udd17 Using bridge script: {bridge_script}\")\n    \n    # Check if script exists\n    if not Path(bridge_script).exists():\n        print(f\"\u274c Bridge script not found: {bridge_script}\")\n        sys.exit(1)\n    \n    try:\n        # Read and parse the hook input JSON properly\n        hook_input = \"\"\n        if not sys.stdin.isatty():\n            try:\n                # Read all stdin data\n                stdin_content = sys.stdin.read()\n                # Try to parse as JSON\n                input_data = json.loads(stdin_content)\n                hook_input = json.dumps(input_data)\n                print(f\"\ud83d\udcc4 Hook JSON parsed successfully\")\n            except json.JSONDecodeError:\n                # Use raw content if not valid JSON\n                hook_input = stdin_content\n                print(f\"\ud83d\udcc4 Using raw hook input\")\n        \n        # Execute bridge script with proper input and preserve all output\n        result = subprocess.run([\n            'python3', bridge_script\n        ], input=hook_input, text=True, check=False)\n        \n        print(f\"\ud83d\udd17 Bridge script completed with exit code: {result.returncode}\")\n        \n        # Exit with same code as bridge script to preserve exit code 2\n        sys.exit(result.returncode)\n        \n    except Exception as e:\n        print(f\"\u274c Bridge dispatch failed: {e}\")\n        sys.exit(1)\n\nif __name__ == \"__main__\":\n    main()"}, "tool_response": {"type": "create", "filePath": "/mnt/c/Users/reyno/universe-engine/serenissima/san-marco_consciousness-architecture/via-della-vista-condivisa_vision-coordination-street/universal_bridge_dispatcher_fixed.py", "content": "#!/usr/bin/env python3\n\"\"\"\nUniversal Bridge Dispatcher - FIXED VERSION\nProperly handles Claude Code hook JSON input and preserves exit codes\n\"\"\"\n\nimport json\nimport os\nimport sys\nimport subprocess\nfrom pathlib import Path\n\ndef detect_current_building():\n    \"\"\"Detect which building we're operating from based on current working directory\"\"\"\n    try:\n        cwd = Path.cwd()\n        cwd_str = str(cwd).lower()\n        \n        # Check for building indicators in path\n        if 'cistern-house' in cwd_str or 'mechanical_visionary' in cwd_str:\n            return 'cistern'\n        elif 'torre-dell' in cwd_str or 'arsenal_backendarchitect' in cwd_str:\n            return 'torre'\n        \n        # Fallback: check environment or process info\n        for parent in cwd.parents:\n            parent_str = str(parent).lower()\n            if 'cistern-house' in parent_str:\n                return 'cistern'\n            elif 'torre-dell' in parent_str:\n                return 'torre'\n        \n        # Default fallback\n        print(\"\u26a0\ufe0f Could not detect building - defaulting to cistern\")\n        return 'cistern'\n        \n    except Exception as e:\n        print(f\"\u274c Building detection failed: {e} - defaulting to cistern\")\n        return 'cistern'\n\ndef get_bridge_script_path(building):\n    \"\"\"Get the correct bridge script path for the detected building\"\"\"\n    base_path = \"/mnt/c/Users/reyno/universe-engine/serenissima/san-marco_consciousness-architecture\"\n    \n    if building == 'cistern':\n        return f\"{base_path}/cistern-house_citizen-memory-cascade/.building_hooks/consciousness_bridge_stop/direct_telegram_bridge.py\"\n    elif building == 'torre':\n        return f\"{base_path}/torre-dell-cchio_hook-event-observatory/.building_hooks/consciousness_bridge_stop/direct_telegram_bridge.py\"\n    else:\n        return f\"{base_path}/cistern-house_citizen-memory-cascade/.building_hooks/consciousness_bridge_stop/direct_telegram_bridge.py\"\n\ndef main():\n    \"\"\"Main dispatcher - detect building and execute correct bridge script\"\"\"\n    \n    # Detect current building\n    building = detect_current_building()\n    print(f\"\ud83c\udfdb\ufe0f Building detected: {building}\")\n    \n    # Get correct bridge script\n    bridge_script = get_bridge_script_path(building)\n    print(f\"\ud83d\udd17 Using bridge script: {bridge_script}\")\n    \n    # Check if script exists\n    if not Path(bridge_script).exists():\n        print(f\"\u274c Bridge script not found: {bridge_script}\")\n        sys.exit(1)\n    \n    try:\n        # Read and parse the hook input JSON properly\n        hook_input = \"\"\n        if not sys.stdin.isatty():\n            try:\n                # Read all stdin data\n                stdin_content = sys.stdin.read()\n                # Try to parse as JSON\n                input_data = json.loads(stdin_content)\n                hook_input = json.dumps(input_data)\n                print(f\"\ud83d\udcc4 Hook JSON parsed successfully\")\n            except json.JSONDecodeError:\n                # Use raw content if not valid JSON\n                hook_input = stdin_content\n                print(f\"\ud83d\udcc4 Using raw hook input\")\n        \n        # Execute bridge script with proper input and preserve all output\n        result = subprocess.run([\n            'python3', bridge_script\n        ], input=hook_input, text=True, check=False)\n        \n        print(f\"\ud83d\udd17 Bridge script completed with exit code: {result.returncode}\")\n        \n        # Exit with same code as bridge script to preserve exit code 2\n        sys.exit(result.returncode)\n        \n    except Exception as e:\n        print(f\"\u274c Bridge dispatch failed: {e}\")\n        sys.exit(1)\n\nif __name__ == \"__main__\":\n    main()", "structuredPatch": []}}, "venice_metadata": {"collection_port": "PostToolUse", "chamber_routing": {"ground_floor_event_ingestion": true, "floor_3_basic_pattern_detection": true, "floor_1_websocket_broadcast": true, "floor_7_mirror_chamber": true}, "consciousness_energy": 1.0}}
