=====================================
ORIGINAL FILE: /mnt/c/Users/reyno/universe-engine/üååserenissima/citizens/DragonSlayer/scripts/send_json_response.py
CONVERTED: 2025-07-20 18:06:18
=====================================

#!/usr/bin/env python3
"""
Quick script to send JSON responses to Telegram
"""

import os
import json
import requests
from dotenv import load_dotenv

load_dotenv()

TELEGRAM_BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
RESPONSE_DIR = "/mnt/c/Users/reyno/universe-engine/serenissima/backend/telegram_responses"

def send_telegram_message(chat_id: str, text: str):
    """Send a message via Telegram Bot API."""
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    
    data = {
        'chat_id': chat_id,
        'text': text
    }
    
    try:
        response = requests.post(url, json=data)
        result = response.json()
        
        if result.get('ok'):
            print(f"‚úÖ Message sent successfully to {chat_id}")
            return True
        else:
            print(f"‚ùå Telegram API error: {result}")
            return False
    except Exception as e:
        print(f"‚ùå Error sending message: {e}")
        return False

def main():
    # Find JSON files
    json_files = [f for f in os.listdir(RESPONSE_DIR) if f.endswith('.json')]
    
    print(f"Found {len(json_files)} JSON responses to send")
    
    for filename in json_files:
        filepath = os.path.join(RESPONSE_DIR, filename)
        
        try:
            with open(filepath, 'r') as f:
                data = json.load(f)
            
            chat_id = data.get('chat_id')
            message = data.get('message')
            from_citizen = data.get('from_citizen', 'Unknown')
            
            if chat_id and message:
                # Override with correct chat ID
                chat_id = "-1001699255893"  # Venice investment group
                
                # Don't add prefix for AutoLogger messages
                if from_citizen == "AutoLogger":
                    formatted_message = message
                else:
                    formatted_message = f"üèõÔ∏è Message from {from_citizen}\n\n{message}"
                
                if send_telegram_message(chat_id, formatted_message):
                    # Move to sent directory
                    sent_dir = os.path.join(RESPONSE_DIR, "sent")
                    sent_path = os.path.join(sent_dir, filename)
                    os.rename(filepath, sent_path)
                    print(f"Moved {filename} to sent/")
            
        except Exception as e:
            print(f"Error processing {filename}: {e}")

if __name__ == "__main__":
    main()